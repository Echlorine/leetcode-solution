# 数据库
事务的四大特性

# MySQL
## 存储引擎
1. InnoDB: 是事务型存储引擎，只支持事务
2. MyISAM: 

### MyISAM 与InnoDB的区别
1. MyISAM 不支持**行级锁**，因此在并发写的时候，性能不好。
2. MyISAM 不支持**事务**；InnoDB 支持事务，具有提交(commit)和回滚(rollback)事务的能力。
3. MyISAM 不支持**外键**，而 InnoDB 支持。
4. MyISAM 不支持**数据库异常崩溃后的安全恢复**，而 InnoDB 支持。
5. MyISAM 不支持**MVCC**，而 InnoDB 支持。

## 锁机制与 InnoDB 锁算法
### 表级锁和行级锁对比
- 表级锁：MySQL 中锁定**粒度最大**的一种锁，加锁快，不会出现死锁，触发锁冲突的概率最高，并发度最低。
- 行级锁：MySQL 中锁定**粒度最小**的一种锁，能大大减少数据库操作的冲突，并发度高，但加锁的开销也最大，加锁慢，会出现死锁。

### InnoDB 存储引擎的锁算法
- Record lock：记录锁，单个行记录上的锁
- Gap lock：间隙锁，锁定一个范围，不包括记录本身
- Next-key lock：record+gap 临键锁，锁定一个范围，包含记录本身

## 事务
### 定义
事务是逻辑上的一组操作，要么都执行，要么都不执行。

### 事务的四大特性(ACID)
- 原子性(Atomicity):  事务是最小的执行单位，不允许分割。
- 一致性(Consistency): 执行事务前后，数据保持一致。
- 隔离性(Isolation): 各并发事务之间数据库是独立的。
- 持久性(Durability): 一个事务被提交之后。它对数据库中数据的改变是持久的。
- **保证了事务的持久性、原子性、隔离性之后，一致性才能得到保障。**

### 并发事务带来的问题
- 脏读(Dirty read)
- 丢失修改(Lost to modify)
- 不可重复读(Unrepeatable read)
- 幻读(Phantom read)

### 事务隔离级别
隔离级别|脏读|不可重复读|幻读|含义
:-----:|:--:|:-------:|:--:|:--
读取未提交|&check;|&check;|&check;|最低的隔离级别，允许读取尚未提交的数据变更
读取已提交|&cross;|&check;|&check;|允许读取并发事务已经提交的数据
可重复读|&cross;|&cross;|&check;|对同一字段的多次读取结果都是一致的，除非数据是被本身事务自己所修改
可串行化|&cross;|&cross;|&cross;|最高的隔离级别，完全服从 ACID 的隔离级别。所有的事务依次逐个执行

## MySQL 索引
### 优点
1. 可以大大加快数据的检索**速度**
2. 通过创建唯一性索引，可以保证数据库表中每一行数据的**唯一性**

### 缺点
1. 创建索引和维护索引需要耗费许多时间。
2. 索引需要使用物理文件存储，也会耗费一定空间。